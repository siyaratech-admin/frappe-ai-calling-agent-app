var S=(z,x,_)=>new Promise((G,w)=>{var F=m=>{try{f(_.next(m))}catch(k){w(k)}},h=m=>{try{f(_.throw(m))}catch(k){w(k)}},f=m=>m.done?G(m.value):Promise.resolve(m.value).then(F,h);f((_=_.apply(z,x)).next())});import{c as L,r as d,a as P,b as r,d as t,e as n,w as o,u as s,F as N,f as T,o as i,_ as y,i as p,B as g,t as u,k as C,v as oe,l as I,D as R,H as ne,I as re}from"./index.js";const ie={class:"p-8 max-w-7xl mx-auto h-full flex flex-col"},de={class:"flex justify-between items-center mb-8"},ue={class:"flex gap-2"},me={key:0,class:"flex-1 flex items-center justify-center"},pe={key:1,class:"flex-1 flex flex-col items-center justify-center text-center opacity-80"},ce={class:"bg-gray-50 p-6 rounded-full mb-4"},fe={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ve=["onClick"],ge={class:"flex justify-between items-start mb-2"},xe={class:"font-bold text-lg text-gray-900 group-hover:text-[#4318FF] transition-colors"},be={class:"text-xs text-gray-500 font-medium"},ye={class:"mt-4 flex items-center gap-2 text-sm text-gray-600 bg-gray-50 p-2 rounded"},we={class:"mt-4 space-y-4"},he=["value"],_e={class:"mt-4 h-[70vh] flex flex-col space-y-4"},Fe={class:"bg-gray-50 p-4 rounded-lg border border-gray-200"},ke={class:"flex gap-2 mb-3"},Ce={key:0,class:"flex flex-wrap gap-2 max-h-24 overflow-y-auto"},Ge=["onClick"],Ee={key:1,class:"text-xs text-gray-400 italic"},Se={class:"flex-1 flex flex-col min-h-0 border border-gray-200 rounded-lg"},Ve={class:"bg-gray-100 p-2 border-b border-gray-200 flex justify-between items-center"},je={class:"text-xs text-gray-500"},De={key:0,class:"p-4 text-center"},Me={key:1,class:"flex-1 overflow-y-auto bg-white"},Ne={class:"min-w-full divide-y divide-gray-200"},Te={class:"bg-gray-50 sticky top-0"},Ie={class:"px-4 py-2 w-10"},Ue=["checked"],Ae={class:"divide-y divide-gray-200"},Be={class:"px-4 py-2"},Oe=["value"],$e={class:"px-4 py-2 text-sm font-medium text-gray-900"},Je={class:"px-4 py-2 text-sm text-gray-500"},Le={class:"text-right text-sm text-gray-600"},Pe={class:"text-xl font-bold"},Re={class:"mt-4 space-y-4"},ze={class:"bg-blue-50 border border-blue-100 text-blue-700 px-4 py-3 rounded-md text-sm flex items-center gap-2"},Ke={class:"max-h-32 overflow-y-auto border border-gray-200 rounded p-2 text-xs text-gray-600"},We={class:"font-mono"},He={class:"flex justify-between w-full items-center"},Ye={class:"flex gap-2"},Xe={__name:"BulkEmailing",setup(z){const x=L({url:"ai_calling_agent.api.get_email_groups",auto:!0}),_=L({url:"ai_calling_agent.api.get_call_groups"}),G=L({url:"frappe.client.get_list",params:{doctype:"Contact",fields:["name","first_name","last_name","email_id"],limit:1e3}}),w=d(!1),F=d(!1),h=d(!1),f=d(""),m=d(""),k=d(!1),E=d(""),v=d([]),V=d(""),b=d([]),B=d(!1),j=d(null),U=d([]),D=d(""),M=d(""),O=d(!1),A=P(()=>(G.data||[]).filter(a=>a.email_id)),K=P(()=>A.value.length>0&&A.value.every(a=>v.value.includes(a.name))),$=P(()=>v.value.length+b.value.length);function H(){_.fetch(),f.value="",m.value="",w.value=!0}function Y(){return S(this,null,function*(){if(!(!f.value||!m.value)){k.value=!0;try{const a=yield fetch("/api/method/ai_calling_agent.api.import_call_group_to_email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({call_group_name:f.value,new_title:m.value})}),e=yield a.json();a.ok?(alert(e.message),x.fetch(),w.value=!1):alert(e.message||"Import Failed")}catch(a){console.error(a)}finally{k.value=!1}}})}function q(){G.fetch(),E.value="",v.value=[],b.value=[],V.value="",F.value=!0}function W(){const a=V.value.trim();if(!!a){if(!a.includes("@")||!a.includes(".")){alert("Please enter a valid email address.");return}b.value.includes(a)||b.value.push(a),V.value=""}}function Q(a){b.value.splice(a,1)}function X(){K.value?v.value=[]:v.value=A.value.map(a=>a.name)}function Z(){return S(this,null,function*(){if(!E.value||$.value===0)return;B.value=!0;const a=v.value.map(c=>{const J=G.data.find(se=>se.name===c);return{name:J.name,email:J.email_id}}),e=b.value.map(c=>({name:"External",email:c})),l=[...a,...e];try{yield fetch("/api/method/ai_calling_agent.api.create_email_group",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:E.value,members:JSON.stringify(l)})}),x.fetch(),F.value=!1}catch(c){console.error(c)}finally{B.value=!1}})}function ee(a){return S(this,null,function*(){j.value=a,U.value=[],D.value="",M.value="";try{const l=yield(yield fetch(`/api/resource/AI Email Group/${a.name}`)).json();l.data&&l.data.members&&(U.value=l.data.members),h.value=!0}catch(e){console.error(e)}})}function te(){return S(this,null,function*(){if(!!j.value){O.value=!0;try{const a=yield fetch("/api/method/ai_calling_agent.api.trigger_email_campaign",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_name:j.value.name,subject:D.value,message:M.value})}),e=yield a.json();a.ok?(alert(e.message),h.value=!1):alert(e.message||"Failed")}catch(a){console.error(a),alert("Failed to start campaign")}finally{O.value=!1}}})}function le(){return S(this,null,function*(){if(!!confirm("Are you sure you want to delete this email group?"))try{yield fetch(`/api/resource/AI Email Group/${j.value.name}`,{method:"DELETE"}),x.fetch(),h.value=!1}catch(a){console.error(a),alert("Failed to delete")}})}function ae(a){return a?new Date(a).toLocaleDateString():""}return(a,e)=>(i(),r("div",ie,[t("div",de,[e[15]||(e[15]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"Bulk Emailing"),t("p",{class:"text-gray-600 mt-1"},"Manage email groups and campaigns")],-1)),t("div",ue,[n(s(g),{variant:"outline",onClick:H},{prefix:o(()=>[n(s(y),{name:"download",class:"h-4 w-4"})]),default:o(()=>[e[13]||(e[13]=p(" Import from Call Group ",-1))]),_:1}),n(s(g),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",onClick:q},{prefix:o(()=>[n(s(y),{name:"plus",class:"h-4 w-4"})]),default:o(()=>[e[14]||(e[14]=p(" New Group ",-1))]),_:1})])]),s(x).loading?(i(),r("div",me,[...e[16]||(e[16]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4318FF]"},null,-1)])])):!s(x).data||s(x).data.length===0?(i(),r("div",pe,[t("div",ce,[n(s(y),{name:"mail",class:"h-10 w-10 text-gray-400"})]),e[17]||(e[17]=t("h3",{class:"text-xl font-bold text-gray-900"},"No Email Groups",-1)),e[18]||(e[18]=t("p",{class:"text-gray-500 max-w-sm mt-2 mb-6"}," Import contacts from your call lists or create a new email group. ",-1))])):(i(),r("div",fe,[(i(!0),r(N,null,T(s(x).data,l=>(i(),r("div",{key:l.name,class:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all cursor-pointer group flex flex-col justify-between",onClick:c=>ee(l)},[t("div",null,[t("div",ge,[t("h3",xe,u(l.title),1),n(s(y),{name:"more-horizontal",class:"h-5 w-5 text-gray-400"})]),t("p",be," Created on "+u(ae(l.creation)),1)]),t("div",ye,[n(s(y),{name:"mail",class:"h-4 w-4 text-[#4318FF]"}),e[19]||(e[19]=t("span",null,"Ready to send",-1))])],8,ve))),128))])),n(s(R),{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=l=>w.value=l)},{"body-title":o(()=>[...e[20]||(e[20]=[t("h3",{class:"text-xl font-bold"},"Import from Call Group",-1)])]),"body-content":o(()=>[t("div",we,[e[24]||(e[24]=t("p",{class:"text-sm text-gray-600"}," Select an existing Call Group. We will automatically fetch the email addresses for its members. ",-1)),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Select Source Group",-1)),C(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},[e[21]||(e[21]=t("option",{disabled:"",value:""},"-- Select a Call Group --",-1)),(i(!0),r(N,null,T(s(_).data,l=>(i(),r("option",{key:l.name,value:l.name},u(l.title),9,he))),128))],512),[[oe,f.value]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"New Email Group Name",-1)),C(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>m.value=l),type:"text",placeholder:"e.g. Follow-up Campaign A",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,512),[[I,m.value]])])])]),actions:o(()=>[n(s(g),{variant:"subtle",onClick:e[2]||(e[2]=l=>w.value=!1)},{default:o(()=>[...e[25]||(e[25]=[p("Cancel",-1)])]),_:1}),n(s(g),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",loading:k.value,disabled:!f.value||!m.value,onClick:Y},{default:o(()=>[...e[26]||(e[26]=[p(" Import & Create ",-1)])]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"]),n(s(R),{modelValue:F.value,"onUpdate:modelValue":e[8]||(e[8]=l=>F.value=l),options:{size:"xl"}},{"body-title":o(()=>[...e[27]||(e[27]=[t("h3",{class:"text-xl font-bold"},"Create New Email Group",-1)])]),"body-content":o(()=>[t("div",_e,[t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Group Title",-1)),C(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>E.value=l),type:"text",placeholder:"e.g. Newsletter Subscribers",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,512),[[I,E.value]])]),t("div",Fe,[e[30]||(e[30]=t("label",{class:"block text-sm font-bold text-gray-700 mb-2"},"Add Emails Manually",-1)),t("div",ke,[C(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>V.value=l),onKeyup:ne(W,["enter"]),type:"email",placeholder:"Enter email address (e.g. client@gmail.com)",class:"block flex-1 rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,544),[[I,V.value]]),n(s(g),{variant:"outline",onClick:W},{default:o(()=>[...e[29]||(e[29]=[p("Add",-1)])]),_:1})]),b.value.length>0?(i(),r("div",Ce,[(i(!0),r(N,null,T(b.value,(l,c)=>(i(),r("div",{key:c,class:"bg-white border border-gray-300 text-gray-700 px-2 py-1 rounded-md text-xs flex items-center gap-2"},[t("span",null,u(l),1),t("button",{onClick:J=>Q(c),class:"text-red-500 hover:text-red-700"},[n(s(y),{name:"x",class:"h-3 w-3"})],8,Ge)]))),128))])):(i(),r("div",Ee," No manual emails added yet. "))]),t("div",Se,[t("div",Ve,[e[31]||(e[31]=t("span",{class:"text-sm font-bold text-gray-700"},"Select from Contacts",-1)),t("span",je,u(v.value.length)+" selected",1)]),s(G).loading?(i(),r("div",De," Loading contacts... ")):(i(),r("div",Me,[t("table",Ne,[t("thead",Te,[t("tr",null,[t("th",Ie,[t("input",{type:"checkbox",onChange:X,checked:K.value,class:"rounded text-[#4318FF] focus:ring-[#4318FF]"},null,40,Ue)]),e[32]||(e[32]=t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"}," Name ",-1)),e[33]||(e[33]=t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"}," Email ",-1))])]),t("tbody",Ae,[(i(!0),r(N,null,T(A.value,l=>(i(),r("tr",{key:l.name,class:"hover:bg-gray-50"},[t("td",Be,[C(t("input",{type:"checkbox",value:l.name,"onUpdate:modelValue":e[6]||(e[6]=c=>v.value=c),class:"rounded text-[#4318FF] focus:ring-[#4318FF]"},null,8,Oe),[[re,v.value]])]),t("td",$e,u(l.first_name)+" "+u(l.last_name),1),t("td",Je,u(l.email_id),1)]))),128))])])]))]),t("div",Le,[e[34]||(e[34]=p(" Total Recipients: ",-1)),t("strong",null,u($.value),1),p(" ("+u(v.value.length)+" Contacts + "+u(b.value.length)+" Manual) ",1)])])]),actions:o(()=>[n(s(g),{variant:"subtle",onClick:e[7]||(e[7]=l=>F.value=!1)},{default:o(()=>[...e[35]||(e[35]=[p("Cancel",-1)])]),_:1}),n(s(g),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",loading:B.value,disabled:!E.value||$.value===0,onClick:Z},{default:o(()=>[...e[36]||(e[36]=[p(" Create Group ",-1)])]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"]),n(s(R),{modelValue:h.value,"onUpdate:modelValue":e[12]||(e[12]=l=>h.value=l),options:{size:"xl"}},{"body-title":o(()=>{var l;return[t("h3",Pe,u((l=j.value)==null?void 0:l.title),1)]}),"body-content":o(()=>[t("div",Re,[t("div",ze,[n(s(y),{name:"info",class:"h-4 w-4"}),t("span",null,[e[37]||(e[37]=p("This group contains ",-1)),t("strong",null,u(U.value.length),1),e[38]||(e[38]=p(" members.",-1))])]),t("div",Ke,[(i(!0),r(N,null,T(U.value,l=>(i(),r("div",{key:l.email,class:"flex justify-between py-1 border-b border-gray-100 last:border-0"},[t("span",null,u(l.contact_name||"Guest"),1),t("span",We,u(l.email),1)]))),128))]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email Subject",-1)),C(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>D.value=l),type:"text",placeholder:"e.g. Exclusive Offer for You",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,512),[[I,D.value]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email Content",-1)),C(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=l=>M.value=l),rows:"6",placeholder:"Type your message here...",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,512),[[I,M.value]])])])]),actions:o(()=>[t("div",He,[n(s(g),{variant:"ghost",theme:"red",class:"text-red-600 hover:bg-red-50",onClick:le},{prefix:o(()=>[n(s(y),{name:"trash-2",class:"h-4 w-4"})]),default:o(()=>[e[41]||(e[41]=p(" Delete Group ",-1))]),_:1}),t("div",Ye,[n(s(g),{variant:"subtle",onClick:e[11]||(e[11]=l=>h.value=!1)},{default:o(()=>[...e[42]||(e[42]=[p("Close",-1)])]),_:1}),n(s(g),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",loading:O.value,disabled:!D.value||!M.value,onClick:te},{prefix:o(()=>[n(s(y),{name:"send",class:"h-4 w-4"})]),default:o(()=>[e[43]||(e[43]=p(" Send Campaign ",-1))]),_:1},8,["loading","disabled"])])])]),_:1},8,["modelValue"])]))}};export{Xe as default};
