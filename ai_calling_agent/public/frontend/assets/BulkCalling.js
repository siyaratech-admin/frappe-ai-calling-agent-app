var S=(V,b,d)=>new Promise((_,w)=>{var u=c=>{try{m(d.next(c))}catch(x){w(x)}},F=c=>{try{m(d.throw(c))}catch(x){w(x)}},m=c=>c.done?_(c.value):Promise.resolve(c.value).then(u,F);m((d=d.apply(V,b)).next())});import{r as f,c as A,a as P,b as r,d as t,u as l,h as B,w as o,g as C,e as i,F as $,f as L,o as n,_ as h,i as p,B as y,t as g,k as z,l as O,D as M}from"./index.js";import{B as U}from"./Badge.js";const X={class:"p-8 max-w-7xl mx-auto h-full flex flex-col"},Z={class:"flex justify-between items-center mb-8"},ee={key:0,class:"flex-1 flex items-center justify-center"},te={key:1,class:"flex-1 flex flex-col items-center justify-center text-center opacity-80"},se={class:"bg-gray-50 p-6 rounded-full mb-4"},ae={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},le=["onClick"],oe={class:"flex justify-between items-start mb-2"},ne={class:"font-bold text-lg text-gray-900 group-hover:text-[#4318FF] transition-colors"},re={class:"text-xs text-gray-500 font-medium"},ie={class:"mt-4 flex -space-x-2 overflow-hidden"},de={class:"inline-block h-8 w-8 rounded-full ring-2 ring-white bg-gray-50 flex items-center justify-center text-xs text-gray-400"},ue={class:"mt-6 flex items-center justify-between border-t border-gray-100 pt-4"},ce={class:"text-xl font-bold"},fe={key:0,class:"mt-4 space-y-4"},pe={class:"space-y-1"},ge={key:1,class:"mt-4 flex flex-col h-[50vh]"},me={class:"mb-4"},xe={class:"flex-1 overflow-y-auto border border-gray-200 rounded-lg"},ye={key:0,class:"p-4 text-center text-gray-500"},ve={key:1,class:"p-4 text-center text-gray-500"},he={key:2,class:"min-w-full divide-y divide-gray-200"},be={class:"bg-gray-50 sticky top-0"},_e={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10"},we=["checked"],ke={class:"bg-white divide-y divide-gray-200"},Ce=["onClick"],Fe={class:"px-6 py-4 whitespace-nowrap"},je=["checked"],De={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Se={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Be={class:"mt-2 text-sm text-gray-500 text-right"},Ge={class:"flex w-full justify-between"},Ne={class:"flex gap-2"},$e={class:"flex justify-between items-center w-full pr-8"},Le={class:"text-xl font-bold"},Ve={class:"mt-4 h-[50vh] flex flex-col"},Te={class:"flex-1 overflow-y-auto border border-gray-200 rounded-lg"},Ee={key:0,class:"p-6 text-center text-gray-500"},Ae={key:1,class:"min-w-full divide-y divide-gray-200"},Pe={class:"bg-white divide-y divide-gray-200"},ze={class:"px-6 py-4 text-sm font-medium text-gray-900"},Oe={class:"px-6 py-4 text-sm text-gray-500 font-mono"},Me={class:"px-6 py-4 text-sm text-gray-500"},Ue={class:"flex w-full justify-between items-center"},Je={class:"flex gap-2"},qe={__name:"BulkCalling",setup(V){const b=f(!1),d=f(1),_=f(""),w=f(""),u=f(new Set),F=f(!1),m=f(!1),c=f(null),x=f([]),G=f(!1),N=f(!1),v=A({url:"ai_calling_agent.api.get_call_groups",auto:!0}),j=A({url:"frappe.client.get_list",makeParams(){return{doctype:"Contact",fields:["name","first_name","last_name","mobile_no","phone"],limit:1e3}}}),k=P(()=>{if(!j.data)return[];const a=w.value.toLowerCase();return j.data.filter(e=>{if(!(e.mobile_no||e.phone))return!1;const D=`${e.first_name||""} ${e.last_name||""}`.toLowerCase(),W=(e.mobile_no||e.phone||"").toLowerCase();return D.includes(a)||W.includes(a)})}),T=P(()=>k.value.length>0&&k.value.every(a=>u.value.has(a.name)));function E(){_.value="",u.value.clear(),d.value=1,j.fetch(),b.value=!0}function J(){b.value=!1}function I(a){u.value.has(a.name)?u.value.delete(a.name):u.value.add(a.name)}function R(){T.value?k.value.forEach(a=>u.value.delete(a.name)):k.value.forEach(a=>u.value.add(a.name))}function Y(){return S(this,null,function*(){F.value=!0;const a=[];u.value.forEach(e=>{const s=j.data.find(D=>D.name===e);s&&a.push({name:`${s.first_name||""} ${s.last_name||""}`.trim(),phone:s.mobile_no||s.phone})});try{const e=yield fetch("/api/method/ai_calling_agent.api.create_call_group",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:_.value,members:JSON.stringify(a)})}),s=yield e.json();e.ok?(v.fetch(),b.value=!1):alert(s.message||"Error creating group")}catch(e){console.error(e),alert("Failed to create group")}finally{F.value=!1}})}function q(a){return S(this,null,function*(){c.value=a,m.value=!0,G.value=!0,x.value=[];try{const s=yield(yield fetch(`/api/resource/Call Group/${a.name}`)).json();s.data&&(x.value=s.data.members||[])}catch(e){console.error(e)}finally{G.value=!1}})}function H(){return S(this,null,function*(){if(!!c.value&&!!confirm(`Are you sure you want to call all ${x.value.length} members in this group?`)){N.value=!0;try{const a=yield fetch("/api/method/ai_calling_agent.api.trigger_bulk_call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_name:c.value.name})}),e=yield a.json();a.ok?(alert("Bulk call campaign started successfully! Logs will appear in the dashboard."),m.value=!1):alert(e.message||"Failed to start bulk call")}catch(a){console.error(a),alert("An error occurred")}finally{N.value=!1}}})}function K(){return S(this,null,function*(){if(!!confirm("Are you sure you want to delete this group? This action cannot be undone."))try{yield fetch(`/api/resource/Call Group/${c.value.name}`,{method:"DELETE"}),v.fetch(),m.value=!1}catch(a){console.error(a),alert("Failed to delete group")}})}function Q(a){return a?new Date(a).toLocaleDateString():""}return(a,e)=>(n(),r("div",X,[t("div",Z,[e[8]||(e[8]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"Bulk Calling"),t("p",{class:"text-gray-600 mt-1"},"Create groups and trigger AI campaigns")],-1)),l(v).data&&l(v).data.length>0?(n(),B(l(y),{key:0,variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",onClick:E},{prefix:o(()=>[i(l(h),{name:"plus",class:"h-4 w-4"})]),default:o(()=>[e[7]||(e[7]=p(" New Group ",-1))]),_:1})):C("",!0)]),l(v).loading?(n(),r("div",ee,[...e[9]||(e[9]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4318FF]"},null,-1)])])):!l(v).data||l(v).data.length===0?(n(),r("div",te,[t("div",se,[i(l(h),{name:"layers",class:"h-10 w-10 text-gray-400"})]),e[11]||(e[11]=t("h3",{class:"text-xl font-bold text-gray-900"},"No groups found",-1)),e[12]||(e[12]=t("p",{class:"text-gray-500 max-w-sm mt-2 mb-6"}," Create your first contact group to start a bulk calling campaign. ",-1)),i(l(y),{variant:"solid",size:"lg",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",onClick:E},{prefix:o(()=>[i(l(h),{name:"plus",class:"h-4 w-4"})]),default:o(()=>[e[10]||(e[10]=p(" Create Group ",-1))]),_:1})])):(n(),r("div",ae,[(n(!0),r($,null,L(l(v).data,s=>(n(),r("div",{key:s.name,class:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all flex flex-col justify-between group cursor-pointer",onClick:D=>q(s)},[t("div",null,[t("div",oe,[t("h3",ne,g(s.title),1),i(l(h),{name:"more-horizontal",class:"h-5 w-5 text-gray-400"})]),t("p",re," Created on "+g(Q(s.creation)),1),t("div",ie,[e[13]||(e[13]=t("div",{class:"inline-block h-8 w-8 rounded-full ring-2 ring-white bg-gray-100 flex items-center justify-center text-xs font-bold text-gray-500"}," # ",-1)),e[14]||(e[14]=t("div",{class:"inline-block h-8 w-8 rounded-full ring-2 ring-white bg-[#4318FF]/10 flex items-center justify-center text-xs font-bold text-[#4318FF]"}," AI ",-1)),t("div",de,[i(l(h),{name:"users",class:"h-3 w-3"})])])]),t("div",ue,[e[15]||(e[15]=t("span",{class:"text-xs font-semibold text-gray-500"},"Click to view details",-1)),i(l(h),{name:"arrow-right",class:"h-4 w-4 text-[#4318FF] opacity-0 group-hover:opacity-100 transition-opacity"})])],8,le))),128))])),i(l(M),{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=s=>b.value=s),options:{size:"xl"}},{"body-title":o(()=>[t("h3",ce,g(d.value===1?"Name Your Group":"Add Members"),1)]),"body-content":o(()=>[d.value===1?(n(),r("div",fe,[e[17]||(e[17]=t("p",{class:"text-sm text-gray-600"},"Give your new contact group a clear name.",-1)),t("div",pe,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700"},"Group Title",-1)),z(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>_.value=s),type:"text",placeholder:"e.g. Real Estate Leads - Oct",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,512),[[O,_.value]])])])):C("",!0),d.value===2?(n(),r("div",ge,[t("div",me,[z(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),type:"text",placeholder:"Search contacts...",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-[#4318FF] focus:ring-[#4318FF] sm:text-sm px-3 py-2 border"},null,512),[[O,w.value]])]),t("div",xe,[l(j).loading?(n(),r("div",ye," Loading contacts... ")):k.value.length===0?(n(),r("div",ve," No contacts found ")):(n(),r("table",he,[t("thead",be,[t("tr",null,[t("th",_e,[t("input",{type:"checkbox",checked:T.value,onChange:R,class:"rounded border-gray-300 text-[#4318FF] focus:ring-[#4318FF]"},null,40,we)]),e[18]||(e[18]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Name ",-1)),e[19]||(e[19]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Phone ",-1))])]),t("tbody",ke,[(n(!0),r($,null,L(k.value,s=>(n(),r("tr",{key:s.name,class:"hover:bg-gray-50 cursor-pointer",onClick:D=>I(s)},[t("td",Fe,[t("input",{type:"checkbox",checked:u.value.has(s.name),class:"rounded border-gray-300 text-[#4318FF] focus:ring-[#4318FF] pointer-events-none"},null,8,je)]),t("td",De,g(s.first_name)+" "+g(s.last_name),1),t("td",Se,g(s.mobile_no||s.phone),1)],8,Ce))),128))])]))]),t("div",Be,g(u.value.size)+" contacts selected ",1)])):C("",!0)]),actions:o(()=>[t("div",Ge,[i(l(y),{variant:"subtle",onClick:J},{default:o(()=>[...e[20]||(e[20]=[p("Cancel",-1)])]),_:1}),t("div",Ne,[d.value===2?(n(),B(l(y),{key:0,variant:"outline",onClick:e[2]||(e[2]=s=>d.value=1)},{default:o(()=>[...e[21]||(e[21]=[p("Back",-1)])]),_:1})):C("",!0),d.value===1?(n(),B(l(y),{key:1,variant:"solid",class:"!bg-[#4318FF] !text-white",disabled:!_.value,onClick:e[3]||(e[3]=s=>d.value=2)},{default:o(()=>[...e[22]||(e[22]=[p(" Next ",-1)])]),_:1},8,["disabled"])):C("",!0),d.value===2?(n(),B(l(y),{key:2,variant:"solid",class:"!bg-[#4318FF] !text-white",disabled:u.value.size===0,loading:F.value,onClick:Y},{default:o(()=>[...e[23]||(e[23]=[p(" Create Group ",-1)])]),_:1},8,["disabled","loading"])):C("",!0)])])]),_:1},8,["modelValue"]),i(l(M),{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=s=>m.value=s),options:{size:"2xl"}},{"body-title":o(()=>{var s;return[t("div",$e,[t("h3",Le,g((s=c.value)==null?void 0:s.title),1),i(l(U),{theme:"gray",size:"lg"},{default:o(()=>[p(g(x.value.length)+" Members",1)]),_:1})])]}),"body-content":o(()=>[t("div",Ve,[t("div",Te,[G.value?(n(),r("div",Ee," Loading members... ")):(n(),r("table",Ae,[e[25]||(e[25]=t("thead",{class:"bg-gray-50 sticky top-0"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Contact Name "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Phone "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Status ")])],-1)),t("tbody",Pe,[(n(!0),r($,null,L(x.value,s=>(n(),r("tr",{key:s.name},[t("td",ze,g(s.contact_name),1),t("td",Oe,g(s.phone_number),1),t("td",Me,[i(l(U),{theme:"gray"},{default:o(()=>[...e[24]||(e[24]=[p("Pending",-1)])]),_:1})])]))),128))])]))])])]),actions:o(()=>[t("div",Ue,[i(l(y),{variant:"ghost",theme:"red",class:"text-red-600 hover:bg-red-50",onClick:K},{prefix:o(()=>[i(l(h),{name:"trash-2",class:"h-4 w-4"})]),default:o(()=>[e[26]||(e[26]=p(" Delete Group ",-1))]),_:1}),t("div",Je,[i(l(y),{variant:"subtle",onClick:e[5]||(e[5]=s=>m.value=!1)},{default:o(()=>[...e[27]||(e[27]=[p("Close",-1)])]),_:1}),i(l(y),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",loading:N.value,onClick:H},{prefix:o(()=>[i(l(h),{name:"phone-call",class:"h-4 w-4"})]),default:o(()=>[e[28]||(e[28]=p(" Start Bulk Calling ",-1))]),_:1},8,["loading"])])])]),_:1},8,["modelValue"])]))}};export{qe as default};
