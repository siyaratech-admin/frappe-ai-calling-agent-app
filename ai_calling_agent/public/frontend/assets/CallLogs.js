var W=Object.defineProperty;var N=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var S=(x,r,o)=>r in x?W(x,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):x[r]=o,$=(x,r)=>{for(var o in r||(r={}))G.call(r,o)&&S(x,o,r[o]);if(N)for(var o of N(r))J.call(r,o)&&S(x,o,r[o]);return x};var k=(x,r,o)=>new Promise((s,y)=>{var _=u=>{try{f(o.next(u))}catch(p){y(p)}},C=u=>{try{f(o.throw(u))}catch(p){y(p)}},f=u=>u.done?s(u.value):Promise.resolve(u.value).then(_,C);f((o=o.apply(x,r)).next())});import{r as b,c as K,b as g,d as e,e as m,w as i,u as n,F as O,f as q,o as c,_ as F,i as v,B as w,t as d,j as T,g as V,k as h,v as A,l as I,D as M}from"./index.js";const Q={class:"p-8 max-w-7xl mx-auto"},X={class:"flex justify-between items-center mb-6"},Y={class:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden"},Z={class:"w-full text-left text-sm"},tt={class:"divide-y divide-gray-100"},et={key:0},at={key:1},st={class:"px-6 py-4"},lt={class:"font-medium text-gray-900"},ot={class:"text-xs text-gray-400 mt-0.5"},rt={class:"px-6 py-4 text-gray-900"},nt={class:"px-6 py-4 text-gray-600 font-mono"},it={class:"px-6 py-4 font-mono text-gray-700"},dt={class:"px-6 py-4"},ut={class:"px-6 py-4"},gt={class:"px-6 py-4 text-right flex justify-end gap-2"},mt={class:"text-xl font-bold"},ct={key:0,class:"mt-6 space-y-6"},pt={class:"grid grid-cols-1 md:grid-cols-3 gap-6 bg-gray-50 p-4 rounded-lg border border-gray-100"},xt=["href"],ft=["title"],vt={class:"font-mono text-gray-900 font-bold"},yt={key:0,class:"bg-white border border-gray-200 p-4 rounded-lg shadow-sm"},bt=["src"],wt={key:1,class:"text-sm text-gray-500 italic bg-gray-50 p-3 rounded border border-gray-100"},_t={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ct={class:"flex justify-between items-center mb-1"},ht=["innerHTML"],kt={class:"flex justify-between items-center mb-1"},Ft={class:"relative"},Lt=["innerHTML"],Dt={class:"mt-4 text-gray-700"},Nt={class:"bg-gray-100 p-3 rounded text-sm font-mono font-bold text-gray-900 border border-gray-200"},Tt={__name:"CallLogs",setup(x){const r=b(!1),o=b(!1),s=b({}),y=b(null),_=b(!1),C=b(!1),f=b(!1),u=b(!1),p=K({url:"frappe.client.get_list",params:{doctype:"AI Call Log",fields:["name","party","party_type","phone_number","call_status","lead_status","livekit_room","transcription","ai_summary","creation","duration","recording_url"],order_by:"creation desc",limit:50},auto:!0});function L(l){if(!l)return"00:00";const t=Math.floor(l/60),a=Math.floor(l%60);return`${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}function U(l){return l?new Date(l).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function B(l){const t=(l||"").trim();return t==="Hot"?"bg-green-100 text-green-800":t==="Warm"?"bg-orange-100 text-orange-800":t==="Cold"?"bg-blue-100 text-blue-800":t==="Negative"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}function H(l){const t=(l||"").trim();return t==="Completed"?"bg-green-100 text-green-800":t==="Failed"?"bg-red-100 text-red-800":t==="Initiated"?"bg-blue-100 text-blue-800":t==="No Answer"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}function D(l){return l?l.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,'<strong class="text-gray-900 font-bold">$1</strong>').replace(/(Alex \(AI\):)/g,'<span class="text-[#4318FF] font-medium">$1</span>').replace(/^- (.*)/gm,'<li class="ml-4 list-disc">$1</li>'):'<span class="text-gray-400 italic">No data available.</span>'}function R(l){s.value=$({},l),f.value=!1,u.value=!1,r.value=!0}function E(){return k(this,null,function*(){_.value=!0;try{yield fetch(`/api/resource/AI Call Log/${s.value.name}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({call_status:s.value.call_status,lead_status:s.value.lead_status,ai_summary:s.value.ai_summary,transcription:s.value.transcription})}),yield p.fetch(),r.value=!1}catch(l){console.error(l),alert("Failed to save log.")}finally{_.value=!1}})}function j(l){y.value=l,o.value=!0}function P(){return k(this,null,function*(){if(!!y.value){C.value=!0;try{if((yield fetch(`/api/resource/AI Call Log/${y.value.name}`,{method:"DELETE"})).ok)yield p.fetch(),o.value=!1,y.value=null;else throw new Error("Server returned error")}catch(l){console.error(l),alert("Failed to delete log.")}finally{C.value=!1}}})}return(l,t)=>(c(),g("div",Q,[e("div",X,[t[12]||(t[12]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Call Logs"),e("p",{class:"text-sm text-gray-500 mt-1"},"History of AI interactions")],-1)),m(n(w),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",onClick:t[0]||(t[0]=a=>n(p).fetch())},{prefix:i(()=>[m(n(F),{name:"refresh-cw",class:"h-4 w-4"})]),default:i(()=>[t[11]||(t[11]=v(" Refresh ",-1))]),_:1})]),e("div",Y,[e("table",Z,[t[16]||(t[16]=e("thead",{class:"bg-gray-50 border-b border-gray-200 text-gray-500 font-medium"},[e("tr",null,[e("th",{class:"px-6 py-3"},"ID & Date"),e("th",{class:"px-6 py-3"},"Contact"),e("th",{class:"px-6 py-3"},"Phone"),e("th",{class:"px-6 py-3"},"Duration"),e("th",{class:"px-6 py-3"},"Call Status"),e("th",{class:"px-6 py-3"},"Lead Status"),e("th",{class:"px-6 py-3 text-right"},"Actions")])],-1)),e("tbody",tt,[n(p).loading?(c(),g("tr",et,[...t[13]||(t[13]=[e("td",{colspan:"7",class:"p-6 text-center text-gray-500"},"Loading logs...",-1)])])):!n(p).data||n(p).data.length===0?(c(),g("tr",at,[...t[14]||(t[14]=[e("td",{colspan:"7",class:"p-6 text-center text-gray-500"}," No call logs found. ",-1)])])):(c(!0),g(O,{key:2},q(n(p).data,a=>(c(),g("tr",{key:a.name,class:"hover:bg-gray-50 transition-colors"},[e("td",st,[e("div",lt,d(a.name),1),e("div",ot,d(U(a.creation)),1)]),e("td",rt,d(a.party||"Unknown"),1),e("td",nt,d(a.phone_number),1),e("td",it,d(L(a.duration)),1),e("td",dt,[e("span",{class:T(["inline-flex items-center px-2.5 py-0.5 rounded text-xs font-medium",H(a.call_status)])},d(a.call_status||"Unknown"),3)]),e("td",ut,[e("span",{class:T(["inline-flex items-center px-2.5 py-0.5 rounded text-xs font-medium",B(a.lead_status)])},d(a.lead_status||"Unknown"),3)]),e("td",gt,[m(n(w),{variant:"subtle",size:"sm",class:"text-[#4318FF] hover:bg-[#4318FF]/10",onClick:z=>R(a)},{default:i(()=>[...t[15]||(t[15]=[v(" View ",-1)])]),_:1},8,["onClick"]),m(n(w),{variant:"ghost",theme:"red",size:"sm",onClick:z=>j(a)},{default:i(()=>[m(n(F),{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["onClick"])])]))),128))])])]),m(n(M),{modelValue:r.value,"onUpdate:modelValue":t[8]||(t[8]=a=>r.value=a),options:{size:"2xl"}},{"body-title":i(()=>[e("h3",mt,"Call Details: "+d(s.value.name),1)]),"body-content":i(()=>[s.value?(c(),g("div",ct,[e("div",pt,[e("div",null,[t[17]||(t[17]=e("label",{class:"block text-xs font-semibold text-gray-500 uppercase mb-1"},"Contact",-1)),e("a",{href:`/app/contact/${s.value.party}`,target:"_blank",class:"text-[#4318FF] hover:underline font-medium flex items-center gap-1"},[v(d(s.value.party)+" ",1),m(n(F),{name:"external-link",class:"h-3 w-3"})],8,xt)]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-xs font-semibold text-gray-500 uppercase mb-1"},"LiveKit Room",-1)),e("div",{class:"font-mono text-gray-700 text-sm truncate",title:s.value.livekit_room},d(s.value.livekit_room||"N/A"),9,ft)]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-xs font-semibold text-gray-500 uppercase mb-1"},"Duration",-1)),e("div",vt,d(L(s.value.duration)),1)])]),s.value.recording_url?(c(),g("div",yt,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2"},[e("span",{class:"text-lg"},"\u{1F399}\uFE0F"),v(" Call Recording ")],-1)),e("audio",{controls:"",src:s.value.recording_url,class:"w-full rounded-md h-10"},null,8,bt)])):s.value.call_status==="Completed"?(c(),g("div",wt," \u26A0\uFE0F No recording available for this call. ")):V("",!0),e("div",_t,[e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Call Status",-1)),h(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>s.value.call_status=a),class:"form-select w-full rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-900 focus:border-gray-500 focus:bg-white focus:ring-0 transition-colors"},[...t[21]||(t[21]=[e("option",{value:"Pending"},"Pending",-1),e("option",{value:"Initiated"},"Initiated",-1),e("option",{value:"No Answer"},"No Answer",-1),e("option",{value:"Completed"},"Completed",-1),e("option",{value:"Failed"},"Failed",-1)])],512),[[A,s.value.call_status]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Lead Status",-1)),h(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>s.value.lead_status=a),class:"form-select w-full rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-900 focus:border-gray-500 focus:bg-white focus:ring-0 transition-colors"},[...t[23]||(t[23]=[e("option",{value:"Hot"},"Hot",-1),e("option",{value:"Warm"},"Warm",-1),e("option",{value:"Cold"},"Cold",-1),e("option",{value:"Negative"},"Negative",-1),e("option",{value:"Not a Lead"},"Not a Lead",-1)])],512),[[A,s.value.lead_status]])])]),e("div",null,[e("div",Ct,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 flex items-center gap-2"},[e("span",{class:"text-lg"},"\u{1F916}"),v(" AI Summary ")],-1)),e("button",{onClick:t[3]||(t[3]=a=>u.value=!u.value),class:"text-xs text-[#4318FF] hover:text-[#3311CC] font-medium"},d(u.value?"Show Preview":"Edit Raw Text"),1)]),u.value?h((c(),g("textarea",{key:1,"onUpdate:modelValue":t[4]||(t[4]=a=>s.value.ai_summary=a),rows:"3",class:"w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 focus:bg-white focus:border-gray-500 focus:ring-0 transition-colors"},null,512)),[[I,s.value.ai_summary]]):(c(),g("div",{key:0,class:"w-full h-auto min-h-[5rem] overflow-y-auto rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-800 leading-relaxed",innerHTML:D(s.value.ai_summary)},null,8,ht))]),e("div",null,[e("div",kt,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700"},"Full Transcription",-1)),e("button",{onClick:t[5]||(t[5]=a=>f.value=!f.value),class:"text-xs text-[#4318FF] hover:text-[#3311CC] font-medium"},d(f.value?"Show Preview":"Edit Raw Text"),1)]),e("div",Ft,[f.value?h((c(),g("textarea",{key:1,"onUpdate:modelValue":t[6]||(t[6]=a=>s.value.transcription=a),rows:"10",class:"w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm font-mono text-gray-600 focus:bg-white focus:border-gray-500 focus:ring-0 transition-colors"},null,512)),[[I,s.value.transcription]]):(c(),g("div",{key:0,class:"w-full h-64 overflow-y-auto rounded-md border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-800 leading-relaxed whitespace-pre-wrap",innerHTML:D(s.value.transcription)},null,8,Lt))])])])):V("",!0)]),actions:i(()=>[m(n(w),{variant:"subtle",onClick:t[7]||(t[7]=a=>r.value=!1)},{default:i(()=>[...t[27]||(t[27]=[v("Close",-1)])]),_:1}),m(n(w),{variant:"solid",loading:_.value,onClick:E,class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent"},{default:i(()=>[...t[28]||(t[28]=[v(" Save Changes ",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"]),m(n(M),{modelValue:o.value,"onUpdate:modelValue":t[10]||(t[10]=a=>o.value=a)},{"body-title":i(()=>[...t[29]||(t[29]=[e("h3",{class:"text-xl font-bold text-red-600"},"Delete Call Log",-1)])]),"body-content":i(()=>{var a;return[e("div",Dt,[t[30]||(t[30]=e("p",{class:"mb-2"},"Are you sure you want to delete this call log?",-1)),e("div",Nt," ID: "+d((a=y.value)==null?void 0:a.name),1),t[31]||(t[31]=e("p",{class:"mt-2 text-sm text-gray-500"},"This action cannot be undone.",-1))])]}),actions:i(()=>[m(n(w),{variant:"subtle",onClick:t[9]||(t[9]=a=>o.value=!1)},{default:i(()=>[...t[32]||(t[32]=[v("Cancel",-1)])]),_:1}),m(n(w),{variant:"solid",theme:"red",loading:C.value,onClick:P},{default:i(()=>[...t[33]||(t[33]=[v("Confirm Delete",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"])]))}};export{Tt as default};
