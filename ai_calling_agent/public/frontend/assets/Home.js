var Q=Object.defineProperty;var $=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var T=(v,c,u)=>c in v?Q(v,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):v[c]=u,H=(v,c)=>{for(var u in c||(c={}))X.call(c,u)&&T(v,u,c[u]);if($)for(var u of $(c))Y.call(c,u)&&T(v,u,c[u]);return v};var V=(v,c,u)=>new Promise((o,b)=>{var _=x=>{try{l(u.next(x))}catch(h){b(h)}},C=x=>{try{l(u.throw(x))}catch(h){b(h)}},l=x=>x.done?o(x.value):Promise.resolve(x.value).then(_,C);l((u=u.apply(v,c)).next())});import{r as w,c as Z,a as I,b as d,d as t,e as k,w as y,u as g,t as r,F as N,f as M,g as F,h as tt,o as n,_ as U,i as f,B as S,n as R,j as B,k as A,v as P,l as E,D as et}from"./index.js";const st={class:"p-8 max-w-6xl mx-auto"},at={class:"flex justify-between items-center mb-8"},ot={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"},lt={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-100"},rt={class:"text-3xl font-bold mt-2"},nt={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-100"},it={class:"text-3xl font-bold mt-2 text-green-600"},dt={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-100"},ut={class:"text-3xl font-bold mt-2 text-[#4318FF]"},gt={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},ct={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-100"},mt={class:"h-48 flex items-end gap-2 justify-between px-2"},vt={class:"relative w-full flex justify-center items-end h-32 bg-gray-50 rounded-md overflow-hidden"},xt={class:"absolute -top-8 bg-gray-900 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10"},pt={class:"text-xs text-gray-400 font-medium rotate-0 truncate w-full text-center"},bt={key:0,class:"w-full h-full flex items-center justify-center text-gray-400 text-sm"},yt={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-100"},ft={class:"space-y-4 h-48 overflow-y-auto pr-2"},_t={class:"flex justify-between text-sm mb-1"},ht={class:"font-medium text-gray-700"},wt={class:"text-gray-500"},kt={class:"w-full bg-gray-100 rounded-full h-2.5 overflow-hidden"},Ct={key:0,class:"w-full h-full flex items-center justify-center text-gray-400 text-sm"},Ft={class:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden"},Lt={class:"px-6 py-4 border-b border-gray-100 font-semibold text-gray-700 flex justify-between items-center"},St={class:"text-xs text-gray-400"},At={key:0,class:"p-8 text-center text-gray-500"},Dt={key:1,class:"p-8 text-center text-gray-500"},Nt={key:2},Mt=["onClick"],jt={class:"flex justify-between items-start"},$t={class:"font-medium text-gray-900 group-hover:text-[#4318FF] transition-colors"},Tt={class:"text-sm text-gray-500 mt-1 flex items-center gap-2"},Ht={class:"font-mono text-gray-600 bg-gray-100 px-1.5 rounded text-xs"},Vt={class:"text-right"},It={class:"text-xs text-gray-400 mt-2"},Ut={key:0,class:"mt-2 text-sm text-gray-600 bg-gray-50 p-3 rounded border border-gray-100 line-clamp-2"},Rt={class:"p-4 bg-gray-50 text-center border-t border-gray-100"},Bt={key:1,class:"text-xs text-gray-400"},Pt={class:"text-xl font-bold"},Et={key:0,class:"mt-6 space-y-6"},zt={class:"grid grid-cols-1 md:grid-cols-3 gap-6 bg-gray-50 p-4 rounded-lg border border-gray-100"},Ot=["href"],Wt=["title"],Gt={class:"font-mono text-gray-900 font-bold"},Jt={key:0,class:"bg-white border border-gray-200 p-4 rounded-lg shadow-sm"},Kt=["src"],qt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Qt={class:"flex justify-between items-center mb-1"},Xt=["innerHTML"],Yt={class:"flex justify-between items-center mb-1"},Zt={class:"relative"},te=["innerHTML"],ae={__name:"Home",setup(v){const c=w(!1),u=w(!1),o=w({}),b=w(!1),_=w(!1),C=w(10),l=Z({url:"frappe.client.get_list",makeParams(a){return{doctype:"AI Call Log",fields:["name","phone_number","party","party_type","lead_status","ai_summary","transcription","call_status","livekit_room","creation","duration","recording_url"],order_by:"creation desc",limit:C.value}},auto:!0}),x=I(()=>{if(!l.data)return[];const a={};l.data.forEach(i=>{const m=i.creation.split(" ")[0];a[m]=(a[m]||0)+1});const e=Object.keys(a).sort().slice(-7),p=Math.max(...Object.values(a),1);return e.map(i=>{const m=new Date(i);return{date:i,label:m.toLocaleDateString("en-US",{month:"short",day:"numeric"}),count:a[i],percentage:a[i]/p*100}})}),h=I(()=>{if(!l.data)return[];const a={};l.data.forEach(i=>{const m=i.lead_status||"Unknown";a[m]=(a[m]||0)+1});const e=l.data.length,p={Hot:"bg-green-500",Warm:"bg-orange-400",Cold:"bg-blue-400",Negative:"bg-red-500",Unknown:"bg-gray-300","Not a Lead":"bg-gray-400"};return Object.keys(a).map(i=>({label:i,count:a[i],percentage:Math.round(a[i]/e*100),colorClass:p[i]||"bg-gray-500"})).sort((i,m)=>m.count-i.count)});function z(){C.value+=10,l.fetch()}function O(a){o.value=H({},a),b.value=!1,_.value=!1,c.value=!0}function W(){return V(this,null,function*(){u.value=!0;try{yield fetch(`/api/resource/AI Call Log/${o.value.name}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({call_status:o.value.call_status,lead_status:o.value.lead_status,ai_summary:o.value.ai_summary,transcription:o.value.transcription})}),yield l.fetch(),c.value=!1}catch(a){console.error(a),alert("Failed to save log.")}finally{u.value=!1}})}function G(a){if(!a||a.length===0)return"00:00";const e=a.filter(m=>m.duration>0);if(e.length===0)return"00:00";const p=e.reduce((m,s)=>m+(s.duration||0),0),i=Math.floor(p/e.length);return D(i)}function D(a){if(!a)return"00:00";const e=Math.floor(a/60),p=Math.floor(a%60);return`${e.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`}function J(a){return a?new Date(a).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function K(a){const e=(a||"").trim();return e==="Hot"?"bg-green-100 text-green-800":e==="Warm"?"bg-orange-100 text-orange-800":e==="Cold"?"bg-blue-100 text-blue-800":e==="Negative"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}function j(a){return a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,'<strong class="text-gray-900 font-bold">$1</strong>').replace(/(Alex \(AI\):)/g,'<span class="text-[#4318FF] font-medium">$1</span>').replace(/^- (.*)/gm,'<li class="ml-4 list-disc">$1</li>'):'<span class="text-gray-400 italic">No data available.</span>'}function q(a){return a?a.replace(/\*\*/g,"").replace(/Alex \(AI\):/g,"AI:").substring(0,150)+"...":""}return(a,e)=>{var p,i,m;return n(),d("div",st,[t("div",at,[e[10]||(e[10]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"AI Calling Agent"),t("p",{class:"text-gray-600 mt-1"},"Manage your AI sales team and campaigns")],-1)),k(g(S),{variant:"solid",class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent",onClick:e[0]||(e[0]=s=>g(l).fetch())},{prefix:y(()=>[k(g(U),{name:"refresh-cw",class:"h-4 w-4"})]),default:y(()=>[e[9]||(e[9]=f(" Refresh Data ",-1))]),_:1})]),t("div",ot,[t("div",lt,[e[11]||(e[11]=t("div",{class:"text-gray-500 text-sm font-medium"},"Total Calls",-1)),t("div",rt,r(((p=g(l).data)==null?void 0:p.length)||0),1)]),t("div",nt,[e[12]||(e[12]=t("div",{class:"text-gray-500 text-sm font-medium"},"Hot Leads",-1)),t("div",it,r(((i=g(l).data)==null?void 0:i.filter(s=>s.lead_status==="Hot").length)||0),1)]),t("div",dt,[e[13]||(e[13]=t("div",{class:"text-gray-500 text-sm font-medium"},"Avg Duration",-1)),t("div",ut,r(G(g(l).data)),1)])]),t("div",gt,[t("div",ct,[e[14]||(e[14]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"Calls Per Day",-1)),t("div",mt,[(n(!0),d(N,null,M(x.value,(s,L)=>(n(),d("div",{key:L,class:"flex flex-col items-center gap-2 group flex-1"},[t("div",vt,[t("div",{class:"w-full mx-1 bg-[#4318FF] rounded-t-sm transition-all duration-500 hover:bg-[#3311CC] relative group-hover:opacity-90",style:R({height:`${s.percentage}%`})},null,4),t("div",xt,r(s.count)+" calls ",1)]),t("span",pt,r(s.label),1)]))),128)),x.value.length===0?(n(),d("div",bt," No data available ")):F("",!0)])]),t("div",yt,[e[15]||(e[15]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"Leads by Status",-1)),t("div",ft,[(n(!0),d(N,null,M(h.value,(s,L)=>(n(),d("div",{key:L},[t("div",_t,[t("span",ht,r(s.label),1),t("span",wt,r(s.count)+" ("+r(s.percentage)+"%)",1)]),t("div",kt,[t("div",{class:B(["h-2.5 rounded-full transition-all duration-500",s.colorClass]),style:R({width:`${s.percentage}%`})},null,6)])]))),128)),h.value.length===0?(n(),d("div",Ct," No data available ")):F("",!0)])])]),t("div",Ft,[t("div",Lt,[e[16]||(e[16]=t("span",null,"Recent Call Logs",-1)),t("span",St,"Showing "+r(((m=g(l).data)==null?void 0:m.length)||0)+" calls",1)]),g(l).loading&&!g(l).data?(n(),d("div",At," Loading logs... ")):g(l).data&&g(l).data.length===0?(n(),d("div",Dt," No calls made yet. ")):(n(),d("div",Nt,[(n(!0),d(N,null,M(g(l).data,s=>(n(),d("div",{key:s.name,onClick:L=>O(s),class:"px-6 py-4 border-b border-gray-100 last:border-0 hover:bg-gray-50 transition-colors cursor-pointer group"},[t("div",jt,[t("div",null,[t("div",$t,r(s.phone_number),1),t("div",Tt,[t("span",null,r(s.party||"Unknown Contact"),1),e[17]||(e[17]=t("span",null,"\u2022",-1)),t("span",null,r(J(s.creation)),1),e[18]||(e[18]=t("span",null,"\u2022",-1)),t("span",Ht,r(D(s.duration)),1)])]),t("div",Vt,[t("span",{class:B(["inline-flex items-center px-2.5 py-0.5 rounded text-xs font-medium",K(s.lead_status)])},r(s.lead_status||"Unknown"),3),t("div",It,r(s.name),1)])]),e[19]||(e[19]=t("div",{class:"mt-1 text-sm flex items-center gap-1 text-gray-500"},[t("span",null,"\u{1F916}"),f(),t("strong",null,"AI Summary")],-1)),s.ai_summary?(n(),d("div",Ut,r(q(s.ai_summary)),1)):F("",!0)],8,Mt))),128)),t("div",Rt,[g(l).data.length>=C.value?(n(),tt(g(S),{key:0,variant:"outline",loading:g(l).loading,onClick:z,class:"w-full md:w-auto"},{default:y(()=>[...e[20]||(e[20]=[f(" View More (Load 10) ",-1)])]),_:1},8,["loading"])):(n(),d("span",Bt,"All logs loaded"))])]))]),k(g(et),{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=s=>c.value=s),options:{size:"2xl"}},{"body-title":y(()=>[t("h3",Pt,"Call Details: "+r(o.value.name),1)]),"body-content":y(()=>[o.value?(n(),d("div",Et,[t("div",zt,[t("div",null,[e[21]||(e[21]=t("label",{class:"block text-xs font-semibold text-gray-500 uppercase mb-1"},"Contact",-1)),t("a",{href:`/app/contact/${o.value.party}`,target:"_blank",class:"text-[#4318FF] hover:underline font-medium flex items-center gap-1"},[f(r(o.value.party)+" ",1),k(g(U),{name:"external-link",class:"h-3 w-3"})],8,Ot)]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-xs font-semibold text-gray-500 uppercase mb-1"},"LiveKit Room",-1)),t("div",{class:"font-mono text-gray-700 text-sm truncate",title:o.value.livekit_room},r(o.value.livekit_room||"N/A"),9,Wt)]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-xs font-semibold text-gray-500 uppercase mb-1"},"Duration",-1)),t("div",Gt,r(D(o.value.duration)),1)])]),o.value.recording_url?(n(),d("div",Jt,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2"},[t("span",{class:"text-lg"},"\u{1F399}\uFE0F"),f(" Call Recording ")],-1)),t("audio",{controls:"",src:o.value.recording_url,class:"w-full rounded-md h-10"},null,8,Kt)])):F("",!0),t("div",qt,[t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Call Status",-1)),A(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.call_status=s),class:"form-select w-full rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm"},[...e[25]||(e[25]=[t("option",{value:"Pending"},"Pending",-1),t("option",{value:"Initiated"},"Initiated",-1),t("option",{value:"No Answer"},"No Answer",-1),t("option",{value:"Completed"},"Completed",-1),t("option",{value:"Failed"},"Failed",-1)])],512),[[P,o.value.call_status]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Lead Status",-1)),A(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.lead_status=s),class:"form-select w-full rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm"},[...e[27]||(e[27]=[t("option",{value:"Hot"},"Hot",-1),t("option",{value:"Warm"},"Warm",-1),t("option",{value:"Cold"},"Cold",-1),t("option",{value:"Negative"},"Negative",-1),t("option",{value:"Not a Lead"},"Not a Lead",-1)])],512),[[P,o.value.lead_status]])])]),t("div",null,[t("div",Qt,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 flex items-center gap-2"},[t("span",{class:"text-lg"},"\u{1F916}"),f(" AI Summary ")],-1)),t("button",{onClick:e[3]||(e[3]=s=>_.value=!_.value),class:"text-xs text-[#4318FF] hover:text-[#3311CC] font-medium"},r(_.value?"Show Preview":"Edit Raw Text"),1)]),_.value?A((n(),d("textarea",{key:1,"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.ai_summary=s),rows:"3",class:"w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm"},null,512)),[[E,o.value.ai_summary]]):(n(),d("div",{key:0,class:"w-full h-auto min-h-[5rem] overflow-y-auto rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-800 leading-relaxed",innerHTML:j(o.value.ai_summary)},null,8,Xt))]),t("div",null,[t("div",Yt,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700"},"Full Transcription",-1)),t("button",{onClick:e[5]||(e[5]=s=>b.value=!b.value),class:"text-xs text-[#4318FF] hover:text-[#3311CC] font-medium"},r(b.value?"Show Preview":"Edit Raw Text"),1)]),t("div",Zt,[b.value?A((n(),d("textarea",{key:1,"onUpdate:modelValue":e[6]||(e[6]=s=>o.value.transcription=s),rows:"10",class:"w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm font-mono"},null,512)),[[E,o.value.transcription]]):(n(),d("div",{key:0,class:"w-full h-64 overflow-y-auto rounded-md border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-800 leading-relaxed whitespace-pre-wrap",innerHTML:j(o.value.transcription)},null,8,te))])])])):F("",!0)]),actions:y(()=>[k(g(S),{variant:"subtle",onClick:e[7]||(e[7]=s=>c.value=!1)},{default:y(()=>[...e[31]||(e[31]=[f("Close",-1)])]),_:1}),k(g(S),{variant:"solid",loading:u.value,onClick:W,class:"!bg-[#4318FF] hover:!bg-[#3311CC] !text-white border-transparent"},{default:y(()=>[...e[32]||(e[32]=[f(" Save Changes ",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"])])}}};export{ae as default};
